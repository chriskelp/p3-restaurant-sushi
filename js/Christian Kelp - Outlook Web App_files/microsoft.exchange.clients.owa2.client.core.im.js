try { window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.exchange.clients.owa2.client.core.im.js'] = (new Date()).getTime();
Type.registerNamespace("_im");_im.$1HJ=function(n){_im.$1HJ.initializeBase(this);this.$AL=n};_im.$1HJ.prototype={$AL:null,$6au:function(n){this.$AL.set_$1nr(1);n.$7d4(this.$AL.get_$lM(),null,this.$$d_$732,this.$$d_$1Iy)},$78J:function(n,t,i){if(n===-9){_js.Trace.logInfo(_a.$0.$7G,"AcceptChatAction.ProcessResult: Suppressing 'ConversationEnded' error.");n=0}if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.$AL.set_$1nr(3);_js.Trace.logInfo(_a.$0.$7G,"AcceptChatSession web service call succeeded for chat {0}.",this.$AL.get_$lM());t()},$Tt:function(){_a.$GZ.prototype.$Tt.call(this)}};_im.$17m=function(n,t){this.$5l6=n;this.$6Cu=t};_im.$17m.prototype={$6Cu:null,$5l6:null,$3qw:function(n,t){return this.$5l6.$3qw(n,t)},$4gu:function(n,t){return this.$5l6.$4gu(n,t)},$Ajr:function(n,t){return new _im.$1Wo(n,t)},$7sc:function(n){return this.$6Cu.$7sc(n)}};_im.$1Lr=function(n,t){_im.$1Lr.initializeBase(this);this.$AL=n;this.$79=t};_im.$1Lr.prototype={$AL:null,$79:null,$li:function(){_a.$GZ.prototype.$li.call(this);this.$79.$E3O(this.$AL)},$6au:function(n){if(this.$AL.get_$lM()===-1){this.$AL.set_$1nr(4);return}n.$A7n(this.$AL.get_$lM(),null,this.$$d_$732,this.$$d_$1Iy)},$78J:function(n,t,i){this.$AL.set_$1nr(4);if(!n){i(Error.create("EndChatAction returned false."));return}t()}};_im.$1Ls=function(n){this.$79=n};_im.$1Ls.prototype={$79:null,$7sc:function(n){return new _im.$1Lr(n,this.$79)}};_im.$1Of=function(n){_im.$1Of.initializeBase(this);_a.$4.$1d2(n,"sipUris");this.$1zg=n};_im.$1Of.prototype={$1zg:null,$6au:function(n){n.$8Vu(this.$1zg,null,this.$$d_$732,this.$$d_$1Iy)},$78J:function(n,t,i){if(n<0){i(Error.create("GetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1Qg=function(n){_im.$1Qg.initializeBase(this);this.$3Ow=n};_im.$1Qg.prototype={$3Ow:!1,$2e0:!1,$6au:function(n){n.$8fA(this.$3Ow,null,this.$$d_$732,this.$$d_$1Iy)},$78J:function(n,t,i){if(n<0){if(n!==-2){_js.Trace.logInfo(_a.$0.$7G,"Sign in failed with code {0}, will retry.",n);this.$2e0=!0}i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.$1B3=function(n){_im.$1B3.initializeBase(this);this.$3Ow=n};_im.$1B3.prototype={$3Ow:!1,$6au:function(n){n.$8fB(this.$3Ow,null,this.$$d_$732,this.$$d_$1Iy)},$78J:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.$1WF=function(){_im.$1WF.initializeBase(this)};_im.$1WF.prototype={$6au:function(n){n.$3c1(null,this.$$d_$732,this.$$d_$1Iy)},$78J:function(n,t,i){if(n<0){i(Error.create("ResetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1Wo=function(n,t){_im.$1Wo.initializeBase(this);this.$AL=n;this.$3d=t};_im.$1Wo.prototype={$3d:null,$AL:null,$li:function(){_a.$GZ.prototype.$li.call(this)},$6au:function(n){this.$AL.get_$1nr()||this.$AL.set_$1nr(1);var t=new _g.$W1(this.$3d);t.ChatSessionId=this.$AL.get_$lM();t.Recipients=this.$AL.$Bpv();t.Subject=this.$AL.get_$3t();n.$7GF(t,null,this.$$d_$732,this.$$d_$1Iy)},$78J:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.$AL.set_$lM(n);this.$AL.set_$1nr(3);t()},$Tt:function(){$B(this.$2I.message)&&this.$AL.$z6(_nbs.NonBootStrings.l_IMDeliveryError_Text);_a.$GZ.prototype.$Tt.call(this)}};_im.$1Xf=function(n,t){_im.$1Xf.initializeBase(this);_a.$4.$1q(n,"sipUri");this.$UD=n;this.$4El=t};_im.$1Xf.prototype={$UD:null,$4El:"None",$6au:function(n){var t=new _g.$Zy;t.Presence=this.$4El;n.$7P7(t,null,this.$$d_$732,this.$$d_$1Iy)},$78J:function(n,t,i){var r=n;if(r){i(Error.create("SetPresenceAction failed with InstantMessageOperationError: "+r));return}t()}};_im.$nA=function(n,t,i,r,u){_im.$nA.initializeBase(this);_a.$4.$a(i,"participants");_a.$4.$1Di(i.get_$9(),0,"participants.Count");if(!$B(u)){if(i.get_$9()!==1)throw Error.invalidOperation("imAddress can only be used in conjunction with a single participant.");if(!$B(r))throw Error.invalidOperation("imAddress and itemOrConversation are mutually exclusive.");}this.$79=n;this.$1Q5=this.$7sk(i);_a.$4.$1Di(this.$1Q5.get_$9(),0,"No valid participants.");this.$2eb=t;this.$3QS=r;this.$1XD=u};_im.$nA.prototype={$79:null,$2eb:null,$1Q5:null,$3QS:null,$1XD:null,$li:function(){_a.$GZ.prototype.$li.call(this);if(!$B(this.$2eb)){this.$2eb.$A52(this.$1Q5,this.$3QS,this.$1XD);return}this.$79.$A52(this.$1Q5,this.$3QS,this.$1XD)},$9OI:function(){return 0},$7sk:function(n){for(var u=new _js.$Z,f={},e=n.get_$9(),i=0;i<e;i++){var t=n.get_$D(i);if(t&&this.$79.$1nm(t.get_$Dq())){var r=t.get_$Dq();if(!(r in f)){u.$F(t);f[r]=t}}}return u}};_im.$1G0=function(n,t){this.$79=n;this.$2eb=t};_im.$1G0.prototype={$79:null,$2eb:null,$3qw:function(n,t){return new _im.$nA(this.$79,this.$2eb,n,t,null)},$4gu:function(n,t){var i=new _js.$Z;i.$F(n);return new _im.$nA(this.$79,this.$2eb,i,null,t)}};_im.$1YR=function(n){_im.$1YR.initializeBase(this);_a.$4.$1d2(n,"sipUris");this.$1zg=n};_im.$1YR.prototype={$1zg:null,$6au:function(n){n.$A65(this.$1zg,null,this.$$d_$732,this.$$d_$1Iy)},$78J:function(n,t,i){if(n<0){i(Error.create("SubscribeForPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1aQ=function(n){_im.$1aQ.initializeBase(this);_a.$4.$1q(n,"sipUri");this.$UD=n};_im.$1aQ.prototype={$UD:null,$6au:function(n){n.$AB8(this.$UD,null,this.$$d_$732,this.$$d_$1Iy)},$78J:function(n,t,i){if(n<0){i(Error.create("UnsubscribeFromPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1JV=function(n){this.$6EG=n.get_$EtX();this.$gN={}};_im.$1JV.prototype={$6EG:0,$gN:null,$F:function(n){this.$82H();this.$gN[n.toString()]=this.$2pk()},$IS:function(n){this.$82H();return n.toString()in this.$gN},$2pk:function(){return _a.$7.get_$3A()},$82H:function(){var s=this.$2pk();var u=new(_ff.$1E.$$(String));var f=this.$gN;for(var r in f){var i={key:r,value:f[r]};var h=i.value;var c=h.$21R(this.$6EG);c.$3p(s)<0&&u.$F(i.key)}for(var t=u.$3e(),o=t.length,n=0;n<o;++n){var e=t[n];delete this.$gN[e]}}};_im.$53=function(n,t,i,r,u,f,e){this.$$d_$AHD=Function.createDelegate(this,this.$AHD);this.$$d_$Dms=Function.createDelegate(this,this.$Dms);this.$$d_$Dmt=Function.createDelegate(this,this.$Dmt);this.$$d_$Dcf=Function.createDelegate(this,this.$Dcf);this.$$d_$EkD=Function.createDelegate(this,this.$EkD);this.$$d_$42n=Function.createDelegate(this,this.$42n);this.$$d_$DXM=Function.createDelegate(this,this.$DXM);this.$$d_$DkC=Function.createDelegate(this,this.$DkC);this.$$d_$DkD=Function.createDelegate(this,this.$DkD);this.$$d_$DmN=Function.createDelegate(this,this.$DmN);this.$$d_$DmO=Function.createDelegate(this,this.$DmO);this.$$d_$9T0=Function.createDelegate(this,this.$9T0);this.$$d_$9T1=Function.createDelegate(this,this.$9T1);this.$$d_$DSs=Function.createDelegate(this,this.$DSs);this.$$d_$5PM=Function.createDelegate(this,this.$5PM);this.$$d_$A6H=Function.createDelegate(this,this.$A6H);this.$1dq=new _js.$Z;this.$Bg=new _js.$Z;this.$iR=new _js.$Z;_im.$53.resolveInheritance();this.apcl=this.$n;this.rpcl=this.$1B;_im.$53.initializeBase(this);this.$or("Initialization","unknown");this.$aA=t;this.add_$2Zv(this.$aA.$$d_$ADb);if(!n){this.$or("Initialization","Disabled");return}this.$m=i;this.$2Di=!0;this.$1kC=!1;this.$51u=new _im.$1JV(_a.$DR.$B1E(30));var s=new _g.$96;s.NotificationType="InstantMessageNotification";this.$UF=new _h.$DQ(s,this.$m,r);this.$UF.add_$3iF(this.$$d_$A6H);if(u&&e){this.$3Nh=!0;_js.Trace.logInfo(_a.$0.$7G,"ChatManager: Waiting for the pending-get activation event.");var o=this;u.$1l(_a.$bT,function(n){_js.Trace.logInfo(_a.$0.$7G,"ChatManager: Pending-get activated.");o.$1aF=!0;o.$5kG()});var h=this;u.$1l(_a.$wI,function(){h.$7d0()});u.$1l(_a.$Nv,this.$$d_$5PM);f?this.$3f(f):this.$Xq="Disabled"}this.$1dq.add_$20(this.$$d_$DSs);this.$3a5=this.$Aix(this.$m)};_im.$53.$A9u=function(n,t,i){var r;var f,u;if(u=n.$353(function(n){return n.get_$lM()===t},f={val:r}),r=f.val,u){i.val=r;return!0}i.val=null;return!1};_im.$53.$Eui=function(n,t,i){var r;var f,u;var e=(u=n.$353(function(n){var i=n;if(i.get_$hY().get_$9()!==1)return!1;var r=i.get_$hY().get_$D(0);return r.get_$Dq()===t?!0:!1},f={val:r}),r=f.val,u);i.val=r;return e};_im.$53.prototype={$aA:null,$3Nh:!1,$3rY:null,$23W:null,$1aF:!1,$2Kl:!1,$6c7:!1,$51u:null,$m:null,$4Ly:!1,$2Di:!1,$344:!1,$Xq:"unknown",$2eL:null,$1kC:!1,$UF:null,$3a5:null,add_$2Zv:function(n){this.$36(_im.$53.$2Co,n)},remove_$2Zv:function(n){this.$5v(_im.$53.$2Co,n)},get_$4QP:function(){return this.$Xq},get_$xE:function(){return this.$Xq==="SignedIn"},get_$2r:function(){this.$4ap("IsEnabled");return this.$Xq!=="Disabled"},get_$AHk:function(){return this.$1dq},get_$42v:function(){return this.$Bg},get_$5zt:function(){return this.$iR},get_$C8n:function(){return this.$6c7},get_$2LX:function(){this.$4ap("CurrentUserSipUri");return this.$23W},$5kE:function(n){if(!this.$1aF){_js.Trace.logInfo(_a.$0.$7G,"Ignoring a SignIn attempt because the pending-get connection is not yet started.");return}this.$2Di=!0;this.$1kC=n;this.$42n()},$5kI:function(n){_js.Trace.logInfo(_a.$0.$7G,"Signing out.");var t=new _im.$1B3(n);t.add_$2x(this.$$d_$9T1);t.add_$2d(this.$$d_$9T0);this.$or("SignOut:Manual="+n,"AttemptingSignOut");this.$m.$1T(t)},$2gl:function(n,t,i){var f=_im.$4n.$gr(t);var e;var r,u;var o=(u=this.$aA.$5ov(f,r={val:e}),e=r.val,u);this.$6FM(n,f,_im.$4n.$2QW(i),o)},$Eoq:function(n,t){var i=new _im.$1Xf(_im.$4n.$gr(n),t);i.add_$2x(this.$$d_$DmO);i.add_$2d(this.$$d_$DmN);this.$m.$1T(i)},$or:function(n,t){t==="Error";_js.Trace.logInfo(_a.$0.$7G,"SignInState: {0} Requesting change from {1} to {2}",n,this.$Xq,t);var i=this.get_$xE();if(this.$Xq!==t){this.$Xq=t;this.$4(_im.$53.$2eN);this.get_$xE()!==i&&this.$4(_im.$53.$58i)}},$7Z4:function(n,t){_js.Trace.logInfo(_a.$0.$7G,"Setting current user SIP URI to {0}",t);this.$23W=t},$3c1:function(){if(this.$Xq==="SignedIn"){_js.Trace.logInfo(_a.$0.$7G,"ResetPresence");var n=new _im.$1WF;n.add_$2x(this.$$d_$DkD);n.add_$2d(this.$$d_$DkC);this.$m.$1T(n)}},$A52:function(n,t,i){_js.Trace.logInfo(_a.$0.$7G,"Starting chat.");_a.$4.$y(n,"basePersonaParticipants");_a.$4.$1Di(n.get_$9(),0,"basePersonaParticipants.Count");$B(i)||_a.$4.$UJ(n.get_$9(),1,"When imAddress is specified, participant count must be 1.");for(var u=new _js.$Z,w=n.get_$9(),o=0;o<w;o++){var y=n.get_$D(o);var p=_pc.$t.$2L5(y);u.$F(p)}var r=null;if(u.get_$9()===1){var e=u.get_$D(0);var f=null;$B(i)?$B(e.get_$Dq())||(f=e.get_$Dq()):f=i;if(!$B(f)){var h,s;s=_im.$53.$Eui(this.$1dq,f,h={val:r}),r=h.val,s}var c=e.get_$27();if(!_js.$A.$1k(f)&&!_js.$A.$1k(c)){var v=_im.$4n.$gr(f);this.$aA.$2T("StartChat (single participant)",v,c,e.$IG,!0)}}else{var l=this;u.$D9(function(n){var t=n;var r=t.get_$Dq();var i=t.get_$27();if(!_js.$A.$1k(r)&&!_js.$A.$1k(i)){var u=_im.$4n.$gr(r);l.$aA.$2T("StartChat (multiple participants)",u,i,t.$IG,!0)}})}if(!r){r=this.$7sC(u,t);this.$7dG(r);if(!$B(i)){var a=u.get_$D(0);r.$Ea2(a,i)}}_g.$18.isInstanceOfType(t)?r.set_$8qV(t):_g.$6Y.isInstanceOfType(t)&&r.set_$8qQ(t);return r},$3lh:function(n){_js.Trace.logInfo(_a.$0.$7G,"Accepting invitation.");this.$Bg.$3K(n);this.$7dG(n);var t=new _im.$1HJ(n);this.$m.$1T(t)},$420:function(n){_js.Trace.logInfo(_a.$0.$7G,"Ignoring invitation.");this.$Bg.$3K(n);this.$51u.$F(n.get_$lM())},$AHH:function(n){_js.Trace.logInfo(_a.$0.$1T5,"Accepting buddy request {0} ",n.get_$2c());var u=this.$iR.$3K(n);var r=this.$4xo(n);var t=new _g.$So;t.GroupType="OtherContacts";var i=new _c.$1HI(r,t);this.$m.$1T(i)},$AmA:function(n){_js.Trace.logInfo(_a.$0.$1T5,"Ignoring buddy request {0} ",n.get_$2c());this.$iR.$3K(n);var i=this.$4xo(n);var t=new _c.$1Ko(i);this.$m.$1T(t)},$E3O:function(n){_js.Trace.logInfo(_a.$0.$7G,"Removing chat {0}",n.get_$lM());n.set_$1nr(4);n.get_$hY().remove_$20(this.$$d_$DXM);var i=this.$1dq.$3K(n);var t=this.$Bg.$3K(n);$B(n.get_$2N())||_h.$r.get_$P().$uV(n.get_$2N().Id)},$Dcf:function(n){if(n.EventType==="Reload"){_js.Trace.logWarning(_a.$0.$7G,"ChatManager.OnIMNotification: Received a 'Reload' notification from the OWA server, assuming server has rebooted or connection re-established");this.$2Di=!0;this.$3gO(!1);return}var t=n;var i=t.PayloadType;if($B(i)){_js.Trace.logWarning(_a.$0.$7G,"ChatManager.OnIMNotification: Unexpected notification payload: {0}, {1}",n.EventType,n.toString());return}if(i==="ServiceUnavailable"){if(t.ServiceError==="ClientSignOut"){_js.Trace.logWarning(_a.$0.$7G,"ChatManager.OnIMNotification: Service unavailable, client signed out.  {0}",t.ErrorMessage);this.$or("IMNotification","SignedOut");return}_js.Trace.logWarning(_a.$0.$7G,"ChatManager.OnIMNotification: Received a 'ServiceUnavailable' notification: {0}, {1}.",t.ServiceError,t.ErrorMessage);this.$3gO(!1);return}if(i==="SignOn")if(t.SignOnStarted){_js.Trace.logInfo(_a.$0.$7G,"ChatManager.OnIMNotification: Sign-on started.");return}else{_js.Trace.logInfo(_a.$0.$7G,"ChatManager.OnIMNotification: Sign-on succeeded.");this.$3gO(!0);this.$72i();this.$6c7=t.IsUserInUcsMode;return}if(i==="UpdateUserPresence"||i==="UserPresenceChange"||i==="QueryUserPresenceChange"){this.$Az1(t);return}this.$aA.$7Ys(t);!$B(t.Persona)&&$B(t.Persona.ImAddress)&&(t.Persona.ImAddress=t.SipUri);if(t.PayloadType==="PendingContactList"){if($B(t.PendingContacts)){_js.Trace.logWarning(_a.$0.$1T5,"The payload for PendingContacts is empty");return}this.$AeK(t.PendingContacts);return}if(t.PayloadType==="AddToBuddyList"){if($B(t.AddedContacts)){_js.Trace.logWarning(_a.$0.$1T5,"The payload for AddedContacts is empty");return}this.$E3L(t.AddedContacts)&&_js.Trace.logInfo(_a.$0.$1T5,"Removed already added contact from pending buddyRequests");return}if(t.PayloadType==="EmptySubscribers"){this.$Ats();_js.Trace.logInfo(_a.$0.$1T5,"Removed already added contact from pending buddyRequests after receiving emptysubscribers");return}if(!("ChatSessionId"in t)){_js.Trace.logInfo(_a.$0.$7G,"Notification {0} not supported, no session id.",i);return}if(this.$51u.$IS(t.ChatSessionId)){_js.Trace.logInfo(_a.$0.$7G,"ChatManager.OnIMNotification: {0} for conversation {1} was ignored.",t.PayloadType,t.ChatSessionId);return}_js.Trace.logInfo(_a.$0.$7G,"ChatManager.OnIMNotification: {0}, Session={1}, SipUri={2}",i,t.ChatSessionId,t.SipUri);var r;var e,o,u,f;if((o=_im.$53.$A9u(this.$1dq,t.ChatSessionId,e={val:r}),r=e.val,o)||(f=_im.$53.$A9u(this.$Bg,t.ChatSessionId,u={val:r}),r=u.val,f)){var s=this.$aA.$3Kf(t.SipUri,t.DisplayName);this.$Dww(t,r,s);return}_js.Trace.logInfo(_a.$0.$7G,"No matching chat found for session {0}",t.ChatSessionId);this.$Ev6(t)},$4dl:function(n){for(var r=n.get_$9(),t=0;t<r;t++){var i=n.get_$D(t);if(i&&this.$1nm(i.SipUri))return!0}return!1},$1nm:function(n){return _js.$A.$1k(n)?!1:_js.$A.$1k(this.get_$2LX())?!1:n.toLowerCase()===this.get_$2LX().toLowerCase()?!1:!0},$2QW:function(n){return _im.$4n.$2QW(n)},$6VF:function(n){return _im.$4n.$6VF(n)},$Aix:function(n){return new _im.$1VO(n)},$Aml:function(){this.$or("DelayInternalSignIn","AttemptingSignIn");_js.$D.get_$P().$2W(_a.$0.$7G,"ChatManager.InternalSignIn",this.$$d_$42n,3e4)},$25:function(){this.remove_$2Zv(this.$aA.$$d_$ADb);_js.$FT.prototype.$25.call(this)},$Dmt:function(n){_js.Trace.logInfo(_a.$0.$7G,"Sign-in action succeeded.  Awaiting notification.");this.$2eL=_js.$D.get_$P().$2W(_a.$0.$7G,"ChatManager.SignInNotificationTimeout",this.$$d_$EkD,1e4)},$Dms:function(n){_js.Trace.logInfo(_a.$0.$7G,"Sign-in action failed.");var t=n;if(t.get_$4i()===-11){_js.Trace.logInfo(_a.$0.$7G,"Automatic sign-in rejected because the user was explicitly signed out.");this.$or("Automatic Sign-In Rejected","SignedOut");return}_js.Trace.logWarning(_a.$0.$7G,"Sign-in failed: {0}",t.$2I.message);this.$3gO(!1)},$EkD:function(){_js.Trace.logWarning(_a.$0.$7G,"Sign-in timeout expired.  Current sign-in state: {0}, ServiceAvailable: {1}.",this.$Xq,this.$4Ly);this.$Xq!=="SignedIn"&&this.$3gO(!1)},$9T1:function(n){_js.Trace.logInfo(_a.$0.$7G,"Sign-out succeeded.");this.$or("SignOutSucceeded","SignedOut")},$A6H:function(n,t){if(!this.$344){_js.Trace.logInfo(_a.$0.$7G,"Subscribed to notifications.");this.$344=!0;this.$42n()}},$8g2:function(n,t,i){if(this.$Xq!=="Disabled"){var r=n?"SignedOut":"Disabled";if(_js.$A.$o(i)){_js.Trace.logInfo(_a.$0.$7G,"The currentUserSipUri is null/empty -> Marking SignInState as disabled.");r="Disabled"}else i=_im.$4n.$gr(i);this.$or("Configuration Updated",r)}this.$3rY=t;this.$7Z4("InternalSetConfiguration",i);this.$2Kl=!0},$42n:function(){if(!this.$344){_js.Trace.logInfo(_a.$0.$7G,"Subscribing to notifications.");this.$UF.$1l(_a.$0.$7G,"OnIMNotification",this.$$d_$Dcf,1);return}_js.Trace.logInfo(_a.$0.$7G,"Signing in. Manual: {0}, will retry: {1}",this.$1kC,this.$2Di);var n=new _im.$1Qg(this.$1kC);n.add_$2x(this.$$d_$Dmt);n.add_$2d(this.$$d_$Dms);this.$or("InternalSignIn","AttemptingSignIn");this.$m.$1T(n);this.$2eL&&(this.$2eL=_js.$D.get_$P().$6g(this.$2eL))},$4xo:function(n){var t=new _g.$Sn;_a.$4.$y(n,"persona");t.DisplayName=n.get_$27();t.SipUri=n.get_$Dq();return t},$7sC:function(n,t){_js.Trace.logInfo(_a.$0.$7G,"Creating new Chat.");var i=new _h.$1r(!0);i.get_$hY().add_$20(this.$$d_$DXM);i.get_$hY().$233(n);i.set_$2N(new _g.$1b("IM:"+Math.random().toString()));if(!t)return i;if(_g.$18.isInstanceOfType(t)){i.set_$8qV(t);return i}if(_g.$6Y.isInstanceOfType(t)){i.set_$8qQ(t);return i}var r=_js.$A.$5X("CreateChat: itemOrConversation type {0} is not supported.",Object.getType(t).getName());_js.Trace.logError(_a.$0.$7G,r);throw Error.invalidOperation(r);},$7dG:function(n){_js.Trace.logInfo(_a.$0.$7G,"Activating chat.");$B(n.get_$2N())||_h.$r.get_$P().$DY(n.get_$2N().Id,n);var t=this.$Bn7(n);this.$1dq.$7W(t,n)},$Dww:function(n,t,i){var u=n.PayloadType;switch(u){case"NewChatMessageToast":_js.Trace.logInfo(_a.$0.$7G,"NewChatMessageToast received and mapped to chat {0}.",t.get_$lM());return;case"ParticipantJoined":this.$aA.$7fd(n);var r;if($B(n.Persona))r=_pc.$t.$4h9(i,n.SipUri);else{r=new _pc.$t;r.$GJ(n.Persona)}t.$DrZ(n.SipUri,r,i);return;case"ParticipantLeft":t.$Dra(n.SipUri,i);return;case"EndChatSession":t.$6X9||this.$Bg.$3K(t);return;case"NewChatMessage":t.$9Qp(i,n.MessageContent);return;case"UserActivity":switch(n.UserActivity){case"FailedDelivery":t.$z6(_nbs.NonBootStrings.l_IMDeliveryError_Text);return;case"Typing":t.$Ejr(i);return;case"StoppedTyping":t.set_$GL("");return;case"TwoOrMoreTyping":t.set_$GL(_nbs.NonBootStrings.l_IMActivityMultipleUsersTyping_Text);return;case"DeliveryTimeout":t.$z6(_nbs.NonBootStrings.l_IMDeliveryTimeout_Text);return;default:return}}},$Ev6:function(n){if(n.PayloadType==="NewChatMessageToast"){this.$aA.$7fd(n);var r=this.$aA.$3Kf(n.SipUri,n.DisplayName);var u=this.$7tP(n.Persona,r,n.SipUri,n.ToastMessage,n.MessageSubject,n.ChatSessionId);_js.Trace.logInfo(_a.$0.$7G,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessageToast).",n.ChatSessionId);return!0}if(n.PayloadType==="NewChatMessage"){var t=this.$aA.$3Kf(n.SipUri,n.DisplayName);var i=this.$7tP(n.Persona,t,n.SipUri,n.MessageContent,"",n.ChatSessionId);i.$9Qp(t,n.MessageContent);_js.Trace.logInfo(_a.$0.$7G,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessage).",n.ChatSessionId);return!0}return!1},$7tP:function(n,t,i,r,u,f){var o;if($B(n))o=_pc.$t.$4h9(t,i);else{o=new _pc.$t;o.$GJ(n)}$B(r)&&(r="");var s=new _js.$Z;s.$F(o);var e=this.$7sC(s,null);e.set_$lM(f);e.$2fm=o;e.$3jE=r;_js.$A.$1k(u)||e.set_$3t(u);this.$Bg.$F(e);return e},$AeK:function(n){_a.$4.$y(n,"senderInfo");for(var u=n,e=u.length,r=0;r<e;++r){var t=u[r];var i=t.SipUri;_js.Trace.logInfo(_a.$0.$1T5,"Adding pending contact to buddy requests list",i);var f=this.$3Kg(t.DisplayName,t.Title,i);this.$8ic(i,!1)||this.$iR.$F(f)}},$E3L:function(n){_a.$4.$y(n,"senderInfo");for(var r=!1,u=n,f=u.length,t=0;t<f;++t){var e=u[t];var i=e.SipUri;_js.Trace.logInfo(_a.$0.$1T5,"Examining the AddToBuddyList payload for existing buddy requests",i);r=this.$8ic(i,!0)}return r},$Ats:function(){_js.Trace.logInfo(_a.$0.$1T5,"Received empty subscribers notification, we need to hide the pending buddy dialogue");this.$iR.$1v()},$3Kg:function(n,t,i){_a.$4.$y(n,"displayName");_a.$4.$y(i,"buddyImAddress");var r=_pc.$t.$4h9(n,i);_js.$A.$o(t)||r.set_$41(t);return r},$8ic:function(n,t){for(var i=0;i<this.$iR.get_$9();i++){var r=this.$iR.get_$D(i);if(!r.get_$Dq().localeCompare(n)){if(t){_js.Trace.logInfo(_a.$0.$1T5,"Removing already added contact from pending buddyRequests",r.get_$Dq());this.$iR.$5g(i)}return!0}}return!1},$Bn7:function(n){var t=this;return this.$1dq.$H7(function(t){return n.$47B.$3p(t.$47B)>=0})},$3gO:function(n){this.$2eL&&(this.$2eL=_js.$D.get_$P().$6g(this.$2eL));var t=this.$4Ly;this.$4Ly=n;if(n&&t){_js.Trace.logInfo(_a.$0.$7G,"Service confirmed available.");return}else if(n&&!t){_js.Trace.logInfo(_a.$0.$7G,"Service resumed.");return}else if(!n&&t){_js.Trace.logInfo(_a.$0.$7G,"Service interrupted.");this.$7d0();this.$9gB();return}else if(!n&&!t){_js.Trace.logInfo(_a.$0.$7G,"Service confirmed unavailable.");this.$9gB();return}_js.Trace.logError(_a.$0.$7G,"Unexpected condition in ChatManager.SetServiceAvailability.")},$72i:function(){this.$or("SignedOn Succeeded","SignedIn");this.$2Di=!0;this.$1kC=!1},$7d0:function(){this.$1dq.$D9(this.$$d_$AHD);this.$Bg.$D9(this.$$d_$AHD);var n=this;this.$1dq.$D9(function(t){t.$EjY(n.$4Ly)})},$9gB:function(){if(this.$Xq==="AttemptingSignIn"||this.$Xq==="SignedIn"||this.$Xq==="Error"){if(this.$2Di){this.$2Di=!1;this.$Aml();return}this.$1kC=!1;this.$or("SignIn-GiveUp","Error")}},$9T0:function(n){_js.Trace.logWarning(_a.$0.$7G,"Sign-out failed: {0}",n.$2I.message);this.$or("SignOutFailed","SignedOut")},$DkD:function(n){_js.Trace.logInfo(_a.$0.$7G,"Reset presence succeeded.")},$DkC:function(n){_js.Trace.logWarning(_a.$0.$7G,"Reset presence failed: {1}",n.$2I.message)},$DmO:function(n){var t=n;_js.Trace.logInfo(_a.$0.$7G,"Set presence to {0} succeeded.",t.$4El)},$DmN:function(n){var t=n;_js.Trace.logWarning(_a.$0.$7G,"Set presence to {0} failed: {1}",t.$4El,n.$2I.message)},$AHD:function(n){var t=n;t.set_$lM(-2);t.$EjZ()},$6FM:function(n,t,i,r){var f=this.$aA.$3Kf(t,null);var e=new _im.$wj(n,t,f,i,r);var u=this.$wp(_im.$53.$2Co);u&&u(e)},$Az1:function(n){var u=this.$wp(_im.$53.$2Co);if(u){var e=n.PayloadType;if(n.PayloadType==="UpdateUserPresence"){var r=n.DisplayName;_js.$A.$1k(r)&&(r=this.$3rY);var s=new _im.$wj(e,this.$23W,r,_im.$4n.$2QW(n.NewUserPresence),!0);u(s);return}if(!$B(n.UserPresenceChanges))for(var h=n.PayloadType!=="QueryUserPresenceChange",f=n.UserPresenceChanges,c=f.length,i=0;i<c;++i){var t=f[i];var o=new _im.$wj(e,t.SipUri,t.UserName,_im.$4n.$2QW(t.Presence),h);u(o)}}},$DXM:function(n,t){switch(t.$3T){case 0:var f=t.$4H;var e=this.$8Qv(f);this.$3a5.$7gO(e);break;case 2:var u=t.$4c;var i=this.$8Qv(u);var r=this.$82y(i);this.$3a5.$2ar(r);break;case 1:case 3:default:_a.$4.$Fo(!1,"Unexpected notification received: "+t.$3T);break}},$8Qv:function(n){var r=new(_ff.$1E.$$(String));if(n)for(var i=n,f=i.length,t=0;t<f;++t){var u=i[t];this.$7fU(r,u)}return r},$82y:function(n){for(var f=this.$6Rm(this.$1dq.$3e()),u=new(_ff.$1E.$$(String)),r=n.get_$21(),e=r.length,t=0;t<e;++t){var i=r[t];f.$5l(i)||u.$F(i)}return u},$DSs:function(n,t){switch(t.$3T){case 0:var f=t.$4H;var e=this.$6Rm(f);this.$3a5.$7gO(e);break;case 2:var u=t.$4c;var i=this.$6Rm(u);var r=this.$82y(i);this.$3a5.$2ar(r);break;case 1:case 3:default:_a.$4.$Fo(!1,"Unexpected notification received: "+t.$3T);break}},$6Rm:function(n){var r=new(_ff.$1E.$$(String));if(n)for(var u=n,e=u.length,t=0;t<e;++t){var o=u[t];var i=o;if(i.get_$hY()){var f=this;i.get_$hY().$D9(function(n){f.$7fU(r,n)})}}return r},$7fU:function(n,t){var r=t;var i=_im.$4n.$gr(r.get_$Dq());i.localeCompare(this.$23W)&&(n.$5l(i)||n.$F(i))},$4ap:function(n){this.$3Nh&&(this.$Xq==="unknown"||!this.$2Kl)&&_js.Trace.logError(_a.$0.$7G,"ChatManager: Do not access {0} until configuration has loaded.",n)},$5kG:function(){if(this.get_$2r()&&this.$1aF&&this.$2Kl){var n=this;_js.$D.get_$P().$2W(_a.$0.$7G,"ChatManager.SignIn",function(){n.$5kE(!1)},5e3)}},$3f:function(n){var r=n.get_$8a().get_$42i();var i=n.get_$4n().get_$NE();var t=n.get_$4n().get_$20o();this.$8g2(r,i,t);this.$5kG()},$5PM:function(n){if(!n.$1Th){this.$2Di=!1;this.$3gO(!1)}}};_im.$17n=function(n,t,i,r,u,f,e){this.$42=n;this.$aA=t;this.$m=i;this.$341=r;this.$N=u;this.$f=f;this.$1sx=e};_im.$17n.prototype={$42:!1,$aA:null,$m:null,$341:null,$N:null,$f:null,$1sx:!1,$79:null,$I:function(){this.$79||(this.$79=new _im.$53(this.$42,this.$aA,this.$m,this.$341,this.$N,this.$f.get_$1b(),this.$1sx));return this.$79}};_im.$W2=function(){this.$$d_$ADb=Function.createDelegate(this,this.$ADb);_im.$W2.initializeBase(this);this.$Ge={}};_im.$W2.prototype={$Ge:null,$3c1:function(){var t=this.$Ge;for(var n in t){var r={key:n,value:t[n]};var i=r.value;i.set_$Ic(0)}},$7Ys:function(n){this.$ADa(n,!1)},$7fd:function(n){this.$ADa(n,!0)},$ADb:function(n){this.$2T(n.$2Y,n.$UD,n.$75,n.$IG,n.$2SU)},$2T:function(n,t,i,r,u){this.$5pw(n,t,i,u);this.$2gl(n,t,r,u)},$3Kf:function(n,t){var i=t;if(_js.$A.$1k(i)&&!_js.$A.$1k(n)){n=_im.$4n.$gr(n);var r=this.$Ge[n];$B(r)||(i=r.$75);_js.$A.$1k(i)&&(i=_im.$4n.$11B(n))}return i},$5ov:function(n,t){t.val=0;n=_im.$4n.$gr(n);var i=this.$Ge[n];if($B(i))return!1;t.val=i.$IG;return!0},$ADa:function(n,t){if(!_js.$A.$1k(n.SipUri)){this.$5pw(n.PayloadType,n.SipUri,n.DisplayName,t);if(!$B(n.NewUserPresence)){var i=_im.$4n.$2QW(n.NewUserPresence);this.$2gl(n.PayloadType,n.SipUri,i,t)}}},$5pw:function(n,t,i,r){var u=this;this.$5qH(n,t,r,function(n){_js.$A.$1k(i)||n.set_$27(i)})},$2gl:function(n,t,i,r){var u=this;this.$5qH(n,t,r,function(n){$B(i)||n.set_$Ic(i)})},$5qH:function(n,t,i,r){t=_im.$4n.$gr(t);var u=this.$Ge[t];if($B(u)){if(!i)return;u=new _im.$17o(t);this.$Ge[t]=u}r(u)}};_im.$17o=function(n){_im.$17o.initializeBase(this);_a.$4.$1q(n,"sipUri");this.$UD=n};_im.$17o.prototype={$UD:null,$75:null,$IG:0,set_$27:function(n){if(this.$75===n)return n;this.$75=n;this.$4("DisplayName");return n},set_$Ic:function(n){if(this.$IG===n)return n;this.$IG=n;this.$4("Presence");return n},toString:function(){return String.format("SipUri: {0}, DisplayName: {1}, Presence: {2}",this.$UD,$B(this.$75)?"":this.$75,this.$IG)}};_im.$17p=function(n,t,i,r){this.$$d_$DeY=Function.createDelegate(this,this.$DeY);this.$jF=n;this.$79=t;this.$17H=i;this.$14B=r;this.$17H.add_$1Is(this.$$d_$DeY);this.$14B.add_$1Is(this.$$d_$DeY)};_im.$17p.prototype={$79:null,$17H:null,$14B:null,$jF:!1,$7e:null,$2ro:!1,$6jX:0,add_$yH:function(n){if(n&&this.$jF){if(this.get_$FD()){n();return}this.$7e||(this.$7e=new Sys.EventHandlerList);this.$7e.addHandler("chatInitialized",n)}},get_$Hi:function(){return this.get_$FD()&&this.$jF?this.$79:null},get_$2Cn:function(){return this.get_$FD()&&this.$jF?this.$17H.get_$1b():null},get_$1TQ:function(){return this.get_$FD()&&this.$jF?this.$14B.get_$1b():null},get_$ti:function(){return this.$jF},get_$FD:function(){if(!this.$2ro&&this.$jF){this.$17H.$I(null);this.$14B.$I(null)}return this.$2ro||!this.$jF},$DeY:function(){this.$6jX++;if(this.$6jX===2){this.$2ro=!0;if(this.$7e){this.$7e.getHandler("chatInitialized")();this.$7e=null}}}};_im.$17q=function(n,t,i,r,u){this.$jF=n;this.$79=t;this.$17H=i;this.$14B=r;this.$Cp=u};_im.$17q.prototype={$jF:!1,$79:null,$17H:null,$14B:null,$Cp:0,$1M:null,$I:function(){_a.$4.$UJ(this.$Cp,"Mouse","ChatProviderFactory.Create - Layout");this.$1M||(this.$1M=new _im.$17p(this.$jF,this.$79,this.$17H,this.$14B));return this.$1M}};_im.$1E4=function(n,t,i){_im.$1E4.initializeBase(this,[n,t,i]);_js.Trace.logInfo(_a.$0.$7G,"PopOutPresenceManager.Ctor.")};_im.$1E4.prototype={get_isPopout:function(){return!0},$Aiw:function(){return new _im.$1VC(this.$1aT)},$5QW:function(n){this.$7Xz(n.$UD,n.$IG)},$7Zc:function(n){this.$2b3.$7fe(n)},$F1L:function(){}};_im.$1VC=function(n){_im.$1VC.initializeBase(this,[n]);_js.Trace.logInfo(_a.$0.$7G,"PopOutPresenceRequestsManager.Ctor")};_im.$1VC.prototype={$7fe:function(n){_a.$4.$1q(n,"sipUri");this.$1aT.queryPresenceInMainWindow(n)},$E4g:function(n){_a.$4.$1q(n,"sipUri");return!0},$AYX:function(){}};_im.$wi=function(n,t,i){this.$$d_$9PM=Function.createDelegate(this,this.$9PM);this.$$d_$5QW=Function.createDelegate(this,this.$5QW);this.$$d_$9Sz=Function.createDelegate(this,this.$9Sz);this.$ce={};_im.$wi.initializeBase(this);_a.$4.$a(n,"chatManager");_a.$4.$a(t,"chatParticipantCache");_a.$4.$a(i,"presenceCrossWindowNotifier");this.$79=n;this.$Ge=t;this.$79.$n(_im.$53.$2eN,this.$$d_$9Sz);this.$79.add_$2Zv(this.$$d_$5QW);this.$1aT=i;this.$2b3=this.$Aiw();this.$2tH=this.$79.$Xq;_js.Trace.logInfo(_a.$0.$Ic,"PresenceManager.Ctor.")};_im.$wi.prototype={$79:null,$Ge:null,$1aT:null,$2b3:null,$2tH:"unknown",get_$xE:function(){return this.$79.$Xq==="SignedIn"},$7Xt:function(n){_a.$4.$a(n,"persona");if(!this.$79.get_$2r())return!1;_js.Trace.logInfo(_a.$0.$Ic,"PresenceManager.TryRegisterForPresenceUpdates: Registering persona for presence updates: {0}, SIP:{1}",n.get_$BY(),n.get_$Dq()||"");n.apcl("ImAddress",this.$$d_$9PM);if(_js.$A.$1k(n.get_$Dq()))return!0;var t=_im.$4n.$gr(n.get_$Dq());this.$F0w(t,n);this.$7Zc(t);return!0},$7Xy:function(n){_a.$4.$a(n,"persona");_js.Trace.logInfo(_a.$0.$Ic,"PresenceManager.TryUnregisterForPresenceUpdates: Unregistering persona for presence updates: {0}, SIP:{1}",n.get_$BY(),n.get_$Dq()||"");return this.$5p3(n,n.get_$Dq())},$Dyd:function(n,t){_a.$4.$1q(n,"sipUri");this.$7Zc(n);t.val=0;if(n in this.$ce){var i=this.$ce[n];if(i.get_$9()>0){t.val=i.get_$D(0).get_$Ic();return!0}}return!1},$Aiw:function(){return new _im.$bs(this.$1aT)},$7Zc:function(n){if(this.get_$xE()){var t;var r,i;(i=this.$Ge.$5ov(n,r={val:t}),t=r.val,i)&&this.$7Xz(n,t);n!==_im.$4n.$gr(this.$79.get_$2LX())&&this.$2b3.$7fe(n)}},$5QW:function(n){if(this.get_$xE()){this.$7Xz(n.$UD,n.$IG);this.$1aT.updatePresenceInAllPopOutWindows(n.$UD,n.$IG)}},$7Xz:function(n,t){n=_im.$4n.$gr(n);if(!(n in this.$ce))return!1;for(var r=this.$ce[n],i=0;i<r.get_$9();i++){var u=r.get_$D(i);u.set_$Ic(t)}return!0},$F1L:function(){this.$1aT.updateSignInStateInAllPopOutWindows(this.$2tH)},$25:function(){_js.Trace.logInfo(_a.$0.$Ic,"PresenceManager.InternalDispose.");this.$79.$1B(_im.$53.$2eN,this.$$d_$9Sz);this.$79.remove_$2Zv(this.$$d_$5QW);this.$2b3.$1t();this.$2b3=null},$5p3:function(n,t){if(!this.$79.get_$2r())return!1;n.rpcl("ImAddress",this.$$d_$9PM);if(_js.$A.$1k(t))return!1;var i=_im.$4n.$gr(t);if(!(i in this.$ce))return!1;var r=this.$ce[i];var u=r.$3K(n);if(!r.get_$9()){delete this.$ce[i];this.$2b3.$E4g(i)}return u},$9Sz:function(n,t){var a=n;var r=this.$2tH;var y=r==="SignedIn";this.$2tH=a.$Xq;var s=this.get_$xE();if(y!==s)if(s){_js.Trace.logInfo(_a.$0.$Ic,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Requesting presence for every persona active.",r,this.$2tH);var e=this.$ce;for(var f in e){var c={key:f,value:e[f]};var l=c.key;this.$7Zc(l)}}else{_js.Trace.logInfo(_a.$0.$Ic,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Resetting presence to Unknown everywhere.",r,this.$2tH);var h=this.$ce;for(var o in h)for(var v={key:o,value:h[o]},u=v.value,i=0;i<u.get_$9();i++)u.get_$D(i).set_$Ic(0);this.$2b3.$AYX();this.$Ge.$3c1()}this.$F1L()},$9PM:function(n,t){var i=n;var r=null;var e=this.$ce;for(var f in e){var u={key:f,value:e[f]};var s=u.key;var o=u.value;if(o.$5l(i)){r=s;break}}_js.Trace.logInfo(_a.$0.$Ic,"PresenceManager.OnImAddressChangedForAPersona: Unregistering persona {0} for old IM Address {1}",i.get_$BY(),r);this.$5p3(i,r);_js.Trace.logInfo(_a.$0.$Ic,"PresenceManager.OnImAddressChangedForAPersona: Re-registering persona {0} for new IM Address {1}",i.get_$BY(),$B(i.get_$Dq())?"":i.get_$Dq());this.$7Xt(i)},$F0w:function(n,t){n in this.$ce||(this.$ce[n]=new(_a.$y.$$(_bc.$v2)));var i=this.$ce[n];if(!i.$5l(t)){i.$F(t);i.get_$9()>1?t.set_$Ic(i.get_$D(0).get_$Ic()):this.get_$xE()||t.set_$Ic(0)}}};_im.$bs=function(n){this.$$d_$Do7=Function.createDelegate(this,this.$Do7);this.$$d_$DbJ=Function.createDelegate(this,this.$DbJ);this.$$d_$DhM=Function.createDelegate(this,this.$DhM);this.$1Q9=new(_a.$y.$$(String));_im.$bs.initializeBase(this);_a.$4.$y(n,"presenceCrossWindowNotifier");this.$1aT=n;this.$1Q9.add_$20(this.$$d_$DhM);_js.Trace.logInfo(_a.$0.$Ic,"PresenceRequestsManager.Ctor")};_im.$bs.prototype={$1aT:null,$2jM:null,$7fe:function(n){_a.$4.$1q(n,"sipUri");if(!this.$1Q9.$5l(n)){_js.Trace.logInfo(_a.$0.$Ic,"PresenceRequestsManager.AddOrUpdatePendingGetRequests: Queuing a presence retrieval request for sip {0}",n);this.$1Q9.$F(n)}},$E4g:function(n){_a.$4.$1q(n,"sipUri");return this.$1Q9.$3K(n)},$AYX:function(){_js.Trace.logInfo(_a.$0.$Ic,"PresenceRequestsManager.ClearAll: Clearing all pending get presence requests: {0}",this.$1Q9.get_$9());this.$1Q9.$1v()},$25:function(){_js.Trace.logInfo(_a.$0.$Ic,"PresenceRequestsManager.InternalDispose.");this.$7mA()},$7mA:function(){if(this.$2jM){_js.Trace.logInfo(_a.$0.$Ic,"PresenceRequestsManager.CancelBatchGetPresenceRequestsTimer.");this.$2jM=_js.$D.get_$P().$6g(this.$2jM)}},$Do7:function(){this.$2jM=null;var t=this.$1Q9.$3e();var i=t.join("; ");this.$1Q9.$1v();var n=new _im.$1Of(t);n.add_$4e(this.$$d_$DbJ);OwaApplication.$2D.$1T(n)},$DhM:function(n,t){if(this.$1Q9.get_$9()>0){if(!this.$2jM){_js.Trace.logInfo(_a.$0.$Ic,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Activating timer to run after {0}ms. Current count of pending requests = {1}",_im.$bs.$7WG,this.$1Q9.get_$9());this.$2jM=_js.$D.get_$P().$2W(_a.$0.$Ic,"GetPresence",this.$$d_$Do7,_im.$bs.$7WG)}}else{_js.Trace.logInfo(_a.$0.$Ic,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Cancelling timer. Current count of pending requests = {0}",this.$1Q9.get_$9());this.$7mA()}},$DbJ:function(n){var t=n;var i=t.$1zg.join("; ");if(t.$2I){_js.Trace.logWarning(_a.$0.$Ic,"PresenceRequestsManager.OnGetPresenceActionCompleted: Failed with {0} for {1} SipUris: '{2}'",t.$2I,this.$1Q9.get_$9(),i);return}}};_im.$1VO=function(n){this.$$d_$Doc=Function.createDelegate(this,this.$Doc);this.$$d_$4GL=Function.createDelegate(this,this.$4GL);this.$$d_$DnX=Function.createDelegate(this,this.$DnX);this.$m=n;this.$2fn=new(_ff.$1E.$$(String));this.$2i6=new(_ff.$1E.$$(String));this.$2GR=new(_ff.$1E.$$(String))};_im.$1VO.prototype={$m:null,$2fn:null,$2i6:null,$2GR:null,$4Zm:!1,$7gO:function(n){for(var i=new(_ff.$1E.$$(String)),f=n.get_$21(),e=f.length,r=0;r<e;++r){var t=f[r];if(this.$2GR.$5l(t)){this.$2GR.$3K(t);continue}this.$2i6.$5l(t)||this.$2fn.$5l(t)||i.$5l(t)||i.$F(t)}if(i.get_$9()>0){this.$2fn.$48(i.get_$21());var u=new _im.$1YR(i.get_$21());u.add_$2x(this.$$d_$DnX);u.add_$2d(this.$$d_$4GL);this.$m.$1T(u)}},$2ar:function(n){for(var i=0;i<n.get_$9();i++){var t=n.get_$D(i);if(this.$2fn.$5l(t)){this.$2fn.$3K(t);continue}this.$2GR.$5l(t)||this.$2i6.$5l(t)&&this.$2GR.$F(t)}this.$A5U()},$A5U:function(){if(this.$2GR.get_$9()&&!this.$4Zm){this.$4Zm=!0;var t=this.$2GR.get_$D(0);this.$2GR.$5g(0);this.$2i6.$3K(t);var n=new _im.$1aQ(t);n.add_$4e(this.$$d_$Doc);this.$m.$1T(n)}},$Doc:function(n){this.$4Zm=!1;this.$A5U()},$DnX:function(n){for(var f=n,r=f.$1zg,u=r.length,t=0;t<u;++t){var i=r[t];this.$2i6.$5l(i)||this.$2i6.$F(i);this.$2fn.$3K(i)}_js.Trace.logInfo(_a.$0.$7G,"SubscribeForPresenceUpdates: succeeded.")},$4GL:function(n){for(var r=n,i=r.$1zg,e=i.length,t=0;t<e;++t){var f=i[t];this.$2fn.$3K(f)}var u=r.$1zg.join(";");_js.Trace.logInfo(_a.$0.$7G,"SubscribeForPresenceUpdates: failed to subscribe for: {0}.",u)}};_im.$wj=function(n,t,i,r,u){_a.$4.$1q(n,"source");_a.$4.$1q(t,"sipUri");this.$2Y=n;this.$UD=t;this.$75=i;this.$IG=r;this.$2SU=u};_im.$wj.prototype={$2Y:null,$UD:null,$75:null,$IG:0,$2SU:!1,toString:function(){return String.format("Source: {0}, Sip: {1}, DisplayName: {2}, Presence: {3}, IsAboutMeOrMyBuddy: {4}",this.$2Y,this.$UD,$B(this.$75)?"":this.$75,this.$IG,this.$2SU)}};_im.$4n=function(){};_im.$4n.$2QW=function(n){switch(n){case"Away":return 3;case"BeRightBack":return 3;case"Busy":return 4;case"DoNotDisturb":return 6;case"IdleBusy":return 4;case"IdleOnline":return 2;case"None":return 0;case"Offline":return 1;case"Online":return 2;default:return 0}};_im.$4n.$6VF=function(n){switch(n){case 2:return"Online";case 3:return"Away";case 5:return"IdleBusy";case 4:return"Busy";case 6:return"DoNotDisturb";case 1:return"Offline";case 0:default:return"None"}};_im.$4n.$gr=function(n){_a.$4.$1q(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")||(t="sip:"+t);return t};_im.$4n.$11B=function(n){_a.$4.$1q(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")&&(t=t.substr(4));return t};function IMComponent(){}IMComponent.$$cctor=function(){_a.$v.get_$P().$q(IMComponent)};IMComponent.prototype={$2ki:function(n,t,i){n.$Bw(_im.$W2).$1J();var h=this;n.$q(_h.$1Ba,function(){return new _im.$1YK(n.$1(_y.$Du))}).$1J();var s=this;n.$q(IChatManagerFactory,function(){var t=i.get_$9q()==="Mouse"&&!_a.$8I.$15t();return new _im.$17n(t,n.$1(_im.$W2),n.$1(_a.$2c),null,n.$1(_ff.$J),n.$WJ(_g.$1y),i.get_$Bh())}).$1J();var c=this;n.$q(_im.$53,function(){return n.$1(IChatManagerFactory).$I()}).$1J();var a=this;n.$q(IChatActionFactory,function(){var t;t=i.get_$1sy()?new _im.$1G0(n.$1(_im.$53),n.$1(_h.$1Ba)):new _im.$1G0(n.$1(_im.$53),null);return new _im.$17m(t,new _im.$1Ls(n.$1(_im.$53)))}).$1J();var l=this;n.$q(_im.$zA,function(){return new _im.$zA(n.$1(_y.$R),n.$1(_rw.$Vo),n.$1(_y.$Du))}).$2V(IChatViewModelFactory);if(i.get_$1sy()){var r=this;n.$q(_im.$1E4,function(){return new _im.$1E4(n.$1(_im.$53),n.$1(_im.$W2),n.$1(_y.$Du))}).$2V(IPresenceManager).$1J()}else{var u=this;n.$q(_im.$wi,function(){return new _im.$wi(n.$1(_im.$53),n.$1(_im.$W2),n.$1(_y.$Du))}).$2V(IPresenceManager).$1J()}var f=this;n.$q(IChatProviderFactory,function(){return new _im.$17q(i.get_$9q()==="Mouse"&&!_a.$8I.$15t(),n.$1(_im.$53),n.$32(IPresenceManager),n.$32(IChatActionFactory),i.get_$9q())}).$1J();var o=this;n.$q(_im.$z9,function(){return new _im.$z9(i.get_$9q(),n.$1(_g.$Q).get_$8cW(),n.$1(_im.$53),n.$1(_im.$zA))}).$1J();var e=this;n.$q(ILwxViewModel,function(){return null}).$1J()},$Bjd:function(){return[new _a.$4a(_im.$z9,2,1),new _a.$4a(_im.$53,2,1)]}};_im.$z9=function(n,t,i,r){if(n==="Mouse"&&t){var u=this;i.get_$AHk().add_$20(function(n,t){if(!t.$3T)for(var i=0;i<t.$4H.length;i++){var u=t.$4H[i];r.$9UK(u)}})}};_im.$Fm=function(n,t,i,r){this.$$d_$3KE=Function.createDelegate(this,this.$3KE);this.$$d_$4bs=Function.createDelegate(this,this.$4bs);this.$$d_$DhB=Function.createDelegate(this,this.$DhB);this.$$d_$5Qt=Function.createDelegate(this,this.$5Qt);_im.$Fm.initializeBase(this);this.$Sv=r;this.$AL=n;this.$Lz=new _C(this.$$d_$5Qt,_a.$0.$7G);this.set_$3ZE(i.$1Ex(1,_bc.$6p.$13z,this.$AL.get_$hY(),2));this.$AL.get_$hY().add_$20(this.$$d_$DhB);t.add_$Wh(this.$$d_$4bs);if(r.get_mainWindowInstance()&&!r.get_mainWindowInstance().closed){var u=this;_a.$3O.$Oo(r.get_mainWindowInstance(),function(n){n.chatWindowReady(u.$AL.get_$Z())})}};_im.$Fm.prototype={$Sv:null,$AL:null,$Lz:null,$799:null,$Qh:null,get_$3ZE:function(){return this.$w(_im.$Fm.$754)},set_$3ZE:function(n){this.$R(_im.$Fm.$754,n);return n},set_$GP:function(n){this.$Qh=n;this.$4("EditorCallContext");return n},get_$4Lr:function(){return this.$w(_im.$Fm.$7Gc)},set_$4Lr:function(n){this.$R(_im.$Fm.$7Gc,n);return n},set_$je:function(n){this.$799=n;this.$4("RawEditorContent");return n},$DhB:function(n,t){switch(t.$3T){case 0:for(var r=0;r<t.$4H.length;r++){var f=t.$4H[r];this.get_$3ZE().$36v(f)}return;case 2:for(var i=t.$4c.length-1;i>=0;i--){var e=t.$4c[i];var o=this;var u=this.get_$3ZE().get_$9T().$H7(function(n){var t=n;return t.$Hx.get_$Dq()===e.get_$Dq()});u<this.get_$3ZE().get_$9T().get_$9()&&this.get_$3ZE().get_$9T().$5g(u)}return}},$5Qt:function(){if(!_js.$A.$o(this.get_$4Lr())){this.$AL.$EiK(this.get_$4Lr());var n=this;_a.$3O.$Oo(this.$Sv.get_mainWindowInstance(),function(t){t.sendChatMessage(n.$AL.get_$2N().Id,n.get_$4Lr())})}},$4bs:function(n){_js.Trace.logInfo(_a.$0.$7G,"ChatViewModel.BeforeUnload invoked.");this.$AL.get_$hY().remove_$20(this.$$d_$DhB);var t=this;_a.$3O.$Oo(this.$Sv.get_mainWindowInstance(),function(n){_js.Trace.logInfo(_a.$0.$7G,"ChatViewModel.BeforeUnload calling into main window.");n.endChat(t.$AL.get_$Z())})},$3KE:function(){var n=new _cmc.$Gj(!0,!1);this.set_$GP(n)}};_im.$zA=function(n,t,i){this.$H=n;this.$9e=t;this.$Sv=i};_im.$zA.prototype={$H:null,$9e:null,$Sv:null,$9UK:function(n){var r={};r.ItemID=n.get_$x();var i=new _y.$Fl;i.set_$7G(n);var t=_bc.$2V.get_$C2O();if(n.$5sD!==-1&&n.$5sI!==-1){t.$5sC=n.$5sD;t.$5sH=n.$5sI}_js.Trace.logInfo(_a.$0.$7G,"ChatViewModelFactory: Chat.BodyText: {0}",n.get_$2jV());var u=this;this.$H.$WF(IChatViewModelFactory,function(){return u},r,t,i,!1)},$yg:function(n,t,i){return null},$19L:function(n,t,i){var u=n.get_$7G();return new _im.$Fm(u,this.$H,this.$9e,this.$Sv)}};_im.$1YK=function(n){this.$Sv=n};_im.$1YK.prototype={$Sv:null,$A52:function(n,t,i){for(var f=new Array(n.get_$9()),e=new Array(n.get_$9()),r=0;r<n.get_$9();r++){var u=n.get_$D(r);f[r]=u.get_$27();e[r]=u.get_$Dq()}var o=$B(t)?null:t.get_$Z();var s=this;_a.$3O.$Oo(this.$Sv.get_mainWindowInstance(),function(n){n.startChat(f,e,o,i)})}};_im.$Qq=function(n){this.$$d_$5Qd=Function.createDelegate(this,this.$5Qd);this.$$d_$Ddu=Function.createDelegate(this,this.$Ddu);this.$$d_$ECp=Function.createDelegate(this,this.$ECp);this.$$d_$AWx=Function.createDelegate(this,this.$AWx);this.$$d_$Drb=Function.createDelegate(this,this.$Drb);_im.$Qq.initializeBase(this,[n]);_im.$Qq.$6aM++;this.$4mq=".ChatMouseView#Handler."+_im.$Qq.$6aM};_im.$Qq.prototype={$4mq:null,$51:null,$OF:null,$3u6:null,$AL:null,$BuL:function(){if(!this.$AL)return null;if(!_js.$A.$o(this.$AL.get_$3t()))return this.$AL.get_$3t();var t=this.$AL.get_$hY();var n=t.get_$9();if(n)if(n===1){var i=t.get_$D(0);return String.format(_nbs.NonBootStrings.l_ChatSubjectOneParticipant_Text,i.get_$27())}else return String.format(_nbs.NonBootStrings.l_ChatSubjectMultipleParticipants_Text,n);else return null},$3R:function(){_js.$3.prototype.$3R.call(this);this.$3u6.$4K(!1);this.$51.$1Jg(100);this.$5Qd(null)},$8H:function(){_js.$C.prototype.$8H.call(this);if(!this.get_$k()){if(this.$AL){this.$AL.get_$hY().remove_$20(this.$$d_$Drb);this.$AL.$1B(_h.$1r.$s1.$3W,this.$$d_$AWx)}this.$AL=null;return}var n=this.get_$k();this.$AL=n.$AL;this.$AL.get_$hY().add_$20(this.$$d_$Drb);this.$AL.$n(_h.$1r.$s1.$3W,this.$$d_$AWx);this.$AL.$n(_h.$1r.$4M0.$3W,this.$$d_$ECp)},$4R:function(){_js.$3.prototype.$4R.call(this);if(!this.$t){this.$OF.$1B(_b.$4F.$41r.$3W,this.$$d_$Ddu);$(window).unbind(this.$4mq);this.$OF=null;this.$51=null;this.$3u6=null;return}this.$51=this.$t.$1F("TranscriptScrollRegion");this.$OF=this.$t.$1F("TranscriptLabel");this.$3u6=this.$t.$1F("Editor");this.$OF.$n(_b.$4F.$41r.$3W,this.$$d_$Ddu);$(window).bind("resize"+this.$4mq,this.$$d_$5Qd);this.$7Pf()},$7Pf:function(){var n=this.$BuL();_js.$A.$o(n)||(window.document.title=n)},$Drb:function(n,t){this.$7Pf()},$AWx:function(n,t){this.$7Pf()},$ECp:function(n,t){if(this.$AL.get_$4Lz()){var i=this.$3u6.get_$S().children("textarea");i.length>0&&i[0].setAttribute("disabled","true")}},$Ddu:function(n,t){var i=this.$51.get_$S();var r=i.prop("scrollHeight");i.scrollTop(r-i.height())},$5Qd:function(n){var t=$(window).height();t>=425&&this.$51.get_$S().height(251+t-425)}};_im._TI=function(){};_im._TI.$$cctor=function(){var n="ChatMouseView";new _A(n,function(){_im._TI.$2[n]===undefined&&(_im._TI.$2[n]=[null,[[-1,0,["ParticipantsViewModel"],[_im._TI.$CnE],null,"DataContext",null,_im._TI.$X,1,null,null,null]],null,[[-1,0,["Chat","BodyText"],[_im._TI.$5Hy,_im._TI.$Cjy],null,"Html",null,_im._TI.$IC,1,null,null,null]],[[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.$5Hy,_im._TI.$92j],null,"Text",null,_im._TI.$2uj,1,null,null,null],[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.$5Hy,_im._TI.$92j],null,"AriaLabel",null,_im._TI.$1i,1,null,null,null]],[[-1,0,["Chat","Status"],[_im._TI.$5Hy,_im._TI.$Cjz],null,"Html",null,_im._TI.$IC,1,null,null,null]],[[-1,4,null,null,null,"EditorAriaLabel",null,_im._TI.$1IF,0,null,null,null,_u.Strings.l_IM_AT_Textbox_Text],[-1,0,["SendCommand"],[_im._TI.$CnG],null,"EnterCommand",null,_im._TI.$CgP,1,null,null,null],[-1,0,["EditorCallContext"],[_im._TI.$CnD],_im._TI.$CnI,"CallContext",_im._TI.$xg,_im._TI.$xh,2,null,null,null],[-1,0,["SendText"],[_im._TI.$CnH],_im._TI.$CnK,"Content",_im._TI.$1Bm,_im._TI.$1Bn,2,null,null,null],[-1,0,["RawEditorContent"],[_im._TI.$CnF],_im._TI.$CnJ,"RawContent",_im._TI.$CgO,_im._TI.$4AV,2,null,null,null]]]);var t=_im._TI._hf.childNodes[0].cloneNode(!0);var i=new _z.$Bl(_B.$3(t,[0,3]),_js.$1.Instance.$1(_y.$R),_js.$1.Instance.$1(_a.$b),_js.$1.Instance.$1(_ff.$J));i.set_$1MU("_im_8 ms-font-weight-regular ms-font-color-black");i.set_$2ra(!1);i.set_$Aux(!0);var o=new _b.$4F(_B.$3(t,[0,2,0]));var s=new _b.$SV(_B.$3(t,[0,1,1]),_js.$1.Instance.$1(_ff.$J));var r=new _b.$4F(_B.$3(t,[0,1,0]));var f=new _fce.$1N(_B.$3(t,[0,1]),_js.$1.Instance.$1(_js.$q),_js.$1.Instance.$1(_ff.$B),_js.$1.Instance.$1(_ff.$J));var u=new _js.$3(_B.$3(t,[0,0,0,0]));u.set_$6("ReadOnlyRecipientWellView");var e=new _fce.$1N(_B.$3(t,[0,0,0]),_js.$1.Instance.$1(_js.$q),_js.$1.Instance.$1(_ff.$B),_js.$1.Instance.$1(_ff.$J));return new _B(t,[e,u,f,r,s,o,i]).R({TranscriptScrollRegion:f,TranscriptLabel:r,Editor:i})},_im.$Fm,_im.$Qq,function(n){return new _im.$Qq(n)},!1,!1,!1,0,_im._TI.$2)};_im._TI.$9P=function(){var n=window.document.createElement("DIV");n.innerHTML="<div> <div class='_im_2'> <div class='_im_3 ms-bg-color-neutralLighter'> <div class='_im_4'> <div></div> </div> </div> <div class='_im_5'> <span></span> <div></div> </div> <div class='_im_6 ms-font-weight-regular ms-font-color-neutralSecondary ms-bg-color-neutralLighter ms-border-color-neutralTertiaryAlt'> <span></span> </div> <Textarea class='_im_7 border-color-transparent ms-border-color-neutralTertiaryAlt-hover'></Textarea> </div> </div>";_js.$C.get_$98().appendChild(n);return n};_im._TI.$CnE=function(n){return n.get_$3ZE()};_im._TI.$5Hy=function(n){return n.$AL};_im._TI.$Cjy=function(n){return n.get_$2jV()};_im._TI.$92j=function(n){return n.get_$8o3()};_im._TI.$Cjz=function(n){return n.get_$GL()};_im._TI.$CnG=function(n){return n.$Lz};_im._TI.$CnD=function(n){return n.$Qh};_im._TI.$xg=function(n){return n.$192};_im._TI.$CnH=function(n){return n.get_$4Lr()};_im._TI.$1Bm=function(n){return n.get_$Cg()};_im._TI.$CnF=function(n){return n.$799};_im._TI.$CgO=function(n){return n.get_$cA()};_im._TI.$X=function(n,t){n.set_$k(t)};_im._TI.$IC=function(n,t){n.set_$Rg(t)};_im._TI.$2uj=function(n,t){n.set_$1O(t)};_im._TI.$1i=function(n,t){n.set_$4V(t)};_im._TI.$CgP=function(n,t){n.set_$RV(t)};_im._TI.$CnI=function(n,t){n.set_$GP(t)};_im._TI.$xh=function(n,t){n.set_$eU(t)};_im._TI.$CnK=function(n,t){n.set_$4Lr(t)};_im._TI.$1Bn=function(n,t){n.set_$Cg(t)};_im._TI.$CnJ=function(n,t){n.set_$je(t)};_im._TI.$4AV=function(n,t){n.set_$cA(t)};_im._TI.$1IF=function(n,t){n.$2Mf=t};_im.$1HJ.registerClass("_im.$1HJ",_h.$1HF.$$(Number));_im.$17m.registerClass("_im.$17m",null,IChatActionFactory);_im.$1Lr.registerClass("_im.$1Lr",_h.$1HF.$$(Boolean));_im.$1Ls.registerClass("_im.$1Ls");_im.$1Of.registerClass("_im.$1Of",_h.$1HF.$$(Number));_im.$1Qg.registerClass("_im.$1Qg",_h.$1HF.$$(Number));_im.$1B3.registerClass("_im.$1B3",_h.$1HF.$$(Number));_im.$1WF.registerClass("_im.$1WF",_h.$1HF.$$(Number));_im.$1Wo.registerClass("_im.$1Wo",_h.$1HF.$$(Number));_im.$1Xf.registerClass("_im.$1Xf",_h.$1HF.$$(Number));_im.$nA.registerClass("_im.$nA",_a.$GZ);_im.$1G0.registerClass("_im.$1G0");_im.$1YR.registerClass("_im.$1YR",_h.$1HF.$$(Number));_im.$1aQ.registerClass("_im.$1aQ",_h.$1HF.$$(Number));_im.$1JV.registerClass("_im.$1JV");_im.$53.registerClass("_im.$53",_js.$FT,IChatManager,_js.$1BC);_im.$17n.registerClass("_im.$17n",null,IChatManagerFactory);_im.$W2.registerClass("_im.$W2",_js.$FT);_im.$17o.registerClass("_im.$17o",_js.$FT);_im.$17p.registerClass("_im.$17p",null,IChatProvider);_im.$17q.registerClass("_im.$17q",null,IChatProviderFactory);_im.$wi.registerClass("_im.$wi",_js.$1gk,IPresenceManager);_im.$1E4.registerClass("_im.$1E4",_im.$wi);_im.$bs.registerClass("_im.$bs",_js.$1gk);_im.$1VC.registerClass("_im.$1VC",_im.$bs);_im.$1VO.registerClass("_im.$1VO");_im.$wj.registerClass("_im.$wj");_im.$4n.registerClass("_im.$4n");IMComponent.registerClass("IMComponent",null,_a.$1e2);_im.$z9.registerClass("_im.$z9");_im.$Fm.registerClass("_im.$Fm",_a.$Ew);_im.$zA.registerClass("_im.$zA",null,IChatViewModelFactory,_bc.$1R0);_im.$1YK.registerClass("_im.$1YK",null,_h.$1Ba);_im.$Qq.registerClass("_im.$Qq",_js.$3);_im._TI.registerClass("_im._TI");_im.$53.$2eN="SignInState";_im.$53.$58i="IsSignedIn";_im.$53.$2Co="Presence";_im.$bs.$7WG=5e3;IMComponent.$$cctor();_im.$Fm.$7Gc=new _H("SendText",String,_im.$Fm,"");_im.$Fm.$754=new _H("ParticipantsViewModel",_rw.$4i,_im.$Fm);_im.$Qq.$6aM=0;_im._TI._hf=_im._TI.$9P();_im._TI.$2={};_im._TI.$$cctor();
window.scriptsLoaded['microsoft.exchange.clients.owa2.client.core.im.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.exchange.clients.owa2.client.core.im.js'] = (new Date()).getTime(); } catch(e) { window.owaLastErrorReported = e; throw e; }
